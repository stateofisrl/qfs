{% extends 'base.html' %}
{% block title %}Transactions{% endblock %}
{% block content %}
<div class="space-y-8 px-4 md:px-0">
  <!-- Back Button (Mobile) -->
  <div class="md:hidden mb-4">
    <a href="/dashboard/" class="flex items-center text-blue-600 hover:text-blue-700 font-semibold transition">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Back to Dashboard
    </a>
  </div>

  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900">Transactions</h1>
      <p class="text-gray-600 mt-2">View and manage all your account transactions</p>
    </div>
    <div>
      <a href="{% url 'transactions-export' %}?type={{ type_filter }}&status={{ status_filter }}&start={{ start }}&end={{ end }}" class="inline-flex items-center px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold transition">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
        </svg>
        Export CSV
      </a>
    </div>
  </div>

  <!-- Filters -->
  <form method="get" class="bg-white border border-gray-300 rounded-lg p-4 md:p-6">
    <div class="grid grid-cols-1 md:grid-cols-6 gap-3 md:gap-4">
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Type</label>
        <select name="type" class="w-full bg-white border border-gray-300 text-gray-900 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="all" {% if type_filter == 'all' %}selected{% endif %}>All Types</option>
          <option value="deposit" {% if type_filter == 'deposit' %}selected{% endif %}>Deposit</option>
          <option value="withdrawal" {% if type_filter == 'withdrawal' %}selected{% endif %}>Withdrawal</option>
          <option value="investment" {% if type_filter == 'investment' %}selected{% endif %}>Investment</option>
          <option value="referral" {% if type_filter == 'referral' %}selected{% endif %}>Referral</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
        <input name="status" value="{{ status_filter }}" placeholder="e.g. approved" class="w-full bg-white border border-gray-300 text-gray-900 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Start Date</label>
        <input type="date" name="start" value="{{ start }}" class="w-full bg-white border border-gray-300 text-gray-900 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">End Date</label>
        <input type="date" name="end" value="{{ end }}" class="w-full bg-white border border-gray-300 text-gray-900 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Per Page</label>
        <select name="page_size" class="w-full bg-white border border-gray-300 text-gray-900 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="20" {% if page_size == 20 %}selected{% endif %}>20</option>
          <option value="50" {% if page_size == 50 %}selected{% endif %}>50</option>
          <option value="100" {% if page_size == 100 %}selected{% endif %}>100</option>
        </select>
      </div>
      <div class="flex items-end">
        <button type="submit" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition">Apply Filters</button>
      </div>
    </div>
  </form>

  <!-- Transactions Table -->
  <div class="bg-white rounded-lg shadow-2xl p-4 md:p-6 border border-gray-300">
    {% if page_obj.object_list %}
    <div class="overflow-x-auto -mx-4 md:mx-0">
      <table class="w-full text-sm">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 md:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Date</th>
            <th class="px-4 md:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Type</th>
            <th class="px-4 md:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider hidden md:table-cell">Details</th>
            <th class="px-4 md:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Amount</th>
            <th class="px-4 md:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Status</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-300">
          {% for t in page_obj.object_list %}
          <tr class="hover:bg-gray-50 transition">
            <td class="px-4 md:px-6 py-4 whitespace-nowrap text-gray-600 text-xs md:text-sm">{{ t.created_at|date:"M d, Y" }}</td>
            <td class="px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 text-xs md:text-sm font-medium">{{ t.type }}</td>
            <td class="px-4 md:px-6 py-4 whitespace-nowrap text-gray-600 text-xs md:text-sm hidden md:table-cell">{{ t.details }}</td>
            <td class="px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 text-xs md:text-sm font-semibold">
              ${{ t.amount|floatformat:2 }}{% if t.currency %} <span class="text-gray-600 font-normal">{{ t.currency }}</span>{% endif %}
            </td>
            <td class="px-4 md:px-6 py-4 whitespace-nowrap">
              {% with s=t.status|lower %}
              <span class="px-2 py-1 rounded-full text-xs font-medium
                {% if 'paid' in s or 'approved' in s or 'completed' in s %} bg-green-100 text-green-800
                {% elif 'pending' in s or 'processing' in s or 'active' in s %} bg-yellow-100 text-yellow-800
                {% elif 'rejected' in s or 'cancel' in s %} bg-red-100 text-red-800
                {% else %} bg-gray-100 text-gray-800 {% endif %}">
                {{ t.status|title }}
              </span>
              {% endwith %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="mt-6 flex flex-col md:flex-row items-center justify-between gap-4 pt-6 border-t border-gray-300">
      <div class="text-sm text-gray-600">
        Page <span class="font-semibold text-gray-900">{{ page_obj.number }}</span> of 
        <span class="font-semibold text-gray-900">{{ paginator.num_pages }}</span>
      </div>
      <div class="flex items-center space-x-2">
        {% if page_obj.has_previous %}
          <a class="px-3 py-2 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg font-medium transition" href="?type={{ type_filter }}&status={{ status_filter }}&start={{ start }}&end={{ end }}&page={{ page_obj.previous_page_number }}&page_size={{ page_size }}">← Previous</a>
        {% else %}
          <span class="px-3 py-2 bg-gray-100 text-gray-400 rounded-lg font-medium">← Previous</span>
        {% endif %}
        {% if page_obj.has_next %}
          <a class="px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition" href="?type={{ type_filter }}&status={{ status_filter }}&start={{ start }}&end={{ end }}&page={{ page_obj.next_page_number }}&page_size={{ page_size }}">Next →</a>
        {% else %}
          <span class="px-3 py-2 bg-gray-100 text-gray-400 rounded-lg font-medium">Next →</span>
        {% endif %}
      </div>
    </div>
    {% else %}
      <div class="text-center py-12">
        <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <p class="text-gray-600 text-lg">No transactions match your filters.</p>
        <p class="text-gray-500 text-sm mt-1">Try adjusting your search criteria</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
